import{P as $e,N as we,Q as Ve,a4 as Pe,a5 as We,r as h,R as ke,a6 as Ge,$ as ce,j as e,J as ae,L as Le,c as Re,a2 as Te,p as P,a as X,M as z,t as Z,F as se,l as ze,n as Ee,a7 as He,q as ne,a8 as Be,u as Ue,e as Ye,m as oe,V as Je,x as E,f as Qe}from"./index-BywWJzti.js";import{u as qe,D as Ke,a as Xe,P as L,b as Ze,c as et}from"./ProgramFieldLocal-uY5QBFw8.js";import{g as tt,C as rt}from"./getDate-CiplD_YF.js";import{A as at,D as de,a as me,b as ue,c as pe}from"./Add-iX1LdWfD.js";import{g as st,b as nt,a as ot}from"./SchedulePage.logic-CGh8byPc.js";import{B as Y}from"./Button-B-EFBJZ7.js";import{R as it,a as H}from"./RadioGroup-BfFq2730.js";import{F as B}from"./FormControlLabel-C0p6GYRl.js";import"./Typography-DO_idQ2S.js";function lt(u){return we("MuiAvatarGroup",u)}const ct=$e("MuiAvatarGroup",["root","avatar"]),ie={small:-16,medium:-8},dt=u=>{const{classes:p}=u;return Le({root:["root"],avatar:["avatar"]},lt,p)},mt=Ve("div",{name:"MuiAvatarGroup",slot:"Root",overridesResolver:(u,p)=>[{[`& .${ct.avatar}`]:p.avatar},p.root]})(Pe(({theme:u})=>({display:"flex",flexDirection:"row-reverse",[`& .${We.root}`]:{border:`2px solid ${(u.vars||u).palette.background.default}`,boxSizing:"content-box",marginLeft:"var(--AvatarGroup-spacing, -8px)","&:last-child":{marginLeft:0}}}))),ut=h.forwardRef(function(p,s){const y=ke({props:p,name:"MuiAvatarGroup"}),{children:i,className:l,component:j="div",componentsProps:g,max:d=5,renderSurplus:S,slotProps:A={},slots:_={},spacing:C="medium",total:M,variant:b="circular",...D}=y;let m=d<2?2:d;const o={...y,max:d,spacing:C,component:j,variant:b},t=dt(o),r=h.Children.toArray(i).filter($=>h.isValidElement($)),x=M||r.length;x===m&&(m+=1),m=Math.min(x+1,m);const v=Math.min(r.length,m-1),O=Math.max(x-m,x-v,0),R=S?S(O):`+${O}`,G=o.spacing&&ie[o.spacing]!==void 0?ie[o.spacing]:-o.spacing||-8,J={slots:_,slotProps:{surplus:A.additionalAvatar??(g==null?void 0:g.additionalAvatar),...g,...A}},[W,k]=Ge("surplus",{elementType:ce,externalForwardedProps:J,className:t.avatar,ownerState:o,additionalProps:{variant:b}});return e.jsxs(mt,{as:j,ownerState:o,className:ae(t.root,l),ref:s,...D,style:{"--AvatarGroup-spacing":G?`${G}px`:void 0,...D.style},children:[O?e.jsx(W,{...k,children:R}):null,r.slice(0,v).reverse().map($=>h.cloneElement($,{className:ae($.props.className,t.avatar),variant:$.props.variant||b}))]})}),pt=Re(e.jsx("path",{d:"M21 7c0-1.38-1.12-2.5-2.5-2.5-.17 0-.34.02-.5.05V4c0-1.38-1.12-2.5-2.5-2.5-.23 0-.46.03-.67.09C14.46.66 13.56 0 12.5 0c-1.23 0-2.25.89-2.46 2.06Q9.785 2 9.5 2C8.12 2 7 3.12 7 4.5v5.89c-.34-.31-.76-.54-1.22-.66l-.77-.21c-.83-.23-1.7.09-2.19.83-.38.57-.4 1.31-.15 1.95l2.56 6.43C6.49 21.91 9.57 24 13 24c4.42 0 8-3.58 8-8zm-2 9c0 3.31-2.69 6-6 6-2.61 0-4.95-1.59-5.91-4.01l-2.6-6.54.53.14c.46.12.83.46 1 .9L7 15h2V4.5c0-.28.22-.5.5-.5s.5.22.5.5V12h2V2.5c0-.28.22-.5.5-.5s.5.22.5.5V12h2V4c0-.28.22-.5.5-.5s.5.22.5.5v8h2V7c0-.28.22-.5.5-.5s.5.22.5.5z"}),"BackHandOutlined"),fe=({id:u,name:p,performer:s,type:y,number:i,date:l,handleDeleteMusic:j})=>{const{attributes:g,listeners:d,setNodeRef:S,transform:A}=qe({id:u}),_=s==="Ward Choir",C=A?{transform:`translate3d(${A.x}px, ${A.y}px, 0)`,opacity:.5}:void 0,M={display:"flex",alignItems:"center",borderRadius:"4px",fontSize:".9rem",cursor:"move",padding:".2rem",border:"1px solid #c69bff"},b={marginTop:".2rem",display:"flex",flexDirection:"column"},D={fontWeight:600},m={fontWeight:600,color:"#fff"},o={textTransform:"capitalize"},t="#efe3ff",r="#c69bff",x="#7e43cf",v="#c69bff";return e.jsxs("div",{ref:S,className:"music-container",style:{backgroundColor:_?"#b681ff":t,...M,...C},children:[e.jsx("div",{...g,...d,style:{cursor:"move",display:"flex",alignItems:"center"},children:e.jsx(Ke,{fontSize:"small",style:{color:_?v:r}})}),e.jsxs("div",{style:b,children:[e.jsx("span",{style:_?m:D,children:p}),e.jsx("i",{style:{color:_?"#e5d1ff":x,...o},children:`${y} (${s})`})]}),e.jsx(Te,{fontSize:"small",style:{color:_?v:r,cursor:"pointer"},className:"edit-button",onClick:()=>j({id:u})})]})},ft={width:"20px",height:"20px",fontSize:"10px",fontWeight:"600",borderColor:"#f6f6f6 !important"},ht={bgcolor:"orange"},gt={bgcolor:"#7e43cf"},yt={bgcolor:"#c69bff"},U=u=>{const{type:p,initials:s,onClick:y}=u,i=p==="organist"?ht:p==="chorister"?gt:yt,l=y?{cursor:"pointer"}:{cursor:"default"};return e.jsx(ce,{sx:[i,ft,l],onClick:y&&y,icon:e.jsx(pt,{}),children:s})},xt=({id:u,items:p,sunday:s,setOpen:y,handleAddMusic:i,specialSundays:l,handleDeleteMusic:j,handleAddChoristerOrganist:g,setChoristerOrganistForm:d,members:S,musicAdmin:A})=>{const{setNodeRef:_}=Xe({id:u}),C=A.find(r=>r.date===s.date),M=l.find(r=>r.date===s.date),b=r=>{const x=S.find(v=>v.id===r);return{member:x,fullName:`${x.first_name} ${x.last_name}`}},D=r=>{var v,O;const x=b(r);return`${((v=x.member.first_name)==null?void 0:v[0])??""}${((O=x.member.last_name)==null?void 0:O[0])??""}`.toUpperCase()},m=()=>{const r=b(C.chorister_id).member??{},x=b(C.organist_id).member??{};d(v=>({...v,chorister:r??{},organist:x??{}})),g()},o=tt(P(s.date))<=7&&P(s.date).getDay()===0&&(P(s.date).getMonth()===3||P(s.date).getMonth()===9),t=p.filter(r=>X(P(r.date),"yyyy-MM-dd")===s.date).map(r=>r.type);return e.jsxs(rt,{ref:_,className:"sunday-card",variant:"outlined",children:[e.jsxs("div",{className:"card--header",children:[e.jsx("div",{className:"card--title",children:X(P(s.date),"MMMM d")}),!o&&e.jsxs(ut,{children:[C?e.jsx(U,{type:"chorister",initials:D(C.chorister_id),onClick:()=>{m()}}):e.jsx(U,{onClick:()=>g(s.date),style:{fill:"#333"}}),C?e.jsx(U,{type:"organist",initials:D(C.organist_id),onClick:()=>{m()}}):e.jsx(U,{onClick:()=>{g(s.date)},style:{fill:"#333"}})]})]}),e.jsxs("div",{className:`card--content ${o||M&&!["Other","Fast Sunday"].includes(M.type)?"special-sunday":""}`,children:[p.filter(r=>X(P(r.date),"yyyy-MM-dd")===s.date).map(r=>(console.log(r),e.jsx(fe,{id:r.id,name:r.name,type:r.type,number:r.hymn_number,performer:r.performer,setOpen:y,date:r.date,handleDeleteMusic:j},r.id))),M&&!["Other","Fast Sunday"].includes(M.type)?e.jsx("div",{className:"special-sunday-type",children:M.description||M.type}):o?e.jsx("div",{className:"special-sunday-type",children:"General Conference"}):e.jsxs("div",{className:"add-item-button",onClick:()=>i(s.date,t),children:[e.jsx(at,{fontSize:"small"}),"Add Music"]})]})]})},vt=u=>{const{open:p,handleClose:s,handleSaveSong:y,setScheduledMusic:i,scheduledMusic:l,members:j,hymns:g,disabledTypes:d}=u,[S,A]=h.useState("Ward Choir"),_=m=>{A(m.target.value),i(o=>({...o,performer:m.target.value})),m.target.value==="Ward Choir"||m.target.value,i(o=>({...o,hymn_number:void 0}))},C=()=>l.type==="intermediate"?e.jsxs(Z,{display:"flex",flexDirection:"column",rowGap:"1rem",children:[e.jsxs(se,{children:[e.jsx(He,{id:"performer",children:"Performer"}),e.jsxs(it,{row:!0,"aria-labelledby":"performer",name:"performer",value:S,onChange:_,defaultChecked:S,children:[e.jsx(B,{value:"Ward Choir",control:e.jsx(H,{}),label:"Ward Choir"}),e.jsx(B,{value:"Ward Member",control:e.jsx(H,{}),label:"Member"}),e.jsx(B,{value:"Congregation",control:e.jsx(H,{}),label:"Congregation"}),e.jsx(B,{value:"Other",control:e.jsx(H,{}),label:"Other"})]})]}),S==="Ward Member"?e.jsx(L,{formValues:l,setFormValues:i,options:j,fieldName:"performer",fieldLabel:"Member",optionText:"first_name last_name"},"performer"):null,S==="Other"?e.jsx(ne,{autoFocus:!1,fullWidth:!0,value:l==null?void 0:l.performer,onChange:o=>i(t=>({...t,performer:o.target.value})),label:"Performer(s)",name:"performer"}):null,S==="Congregation"?e.jsx(L,{formValues:l,setFormValues:i,options:g,fieldName:"hymn_number",fieldLabel:"Hymn Number",optionText:"number name"},"hymn_number"):e.jsx(ne,{autoFocus:!1,fullWidth:!0,value:l==null?void 0:l.name,onChange:o=>i(t=>({...t,name:o.target.value})),label:"Song",name:"song-info"})]}):e.jsx(L,{formValues:l,setFormValues:i,options:g,fieldName:"hymn_number",fieldLabel:"Hymn Number",optionText:"number name"},"hymn_number"),b=[!(d!=null&&d.includes("opening"))&&e.jsx(z,{value:"opening",children:"Opening"},"opening"),!(d!=null&&d.includes("sacrament"))&&e.jsx(z,{value:"sacrament",children:"Sacrament"},"sacrament"),!(d!=null&&d.includes("closing"))&&e.jsx(z,{value:"closing",children:"Closing"},"closing"),!(d!=null&&d.includes("intermediate"))&&e.jsx(z,{value:"intermediate",children:"Intermediate"},"intermediate")].filter(Boolean),D=b[0]&&b[0].props.value;return e.jsx(e.Fragment,{children:e.jsxs(de,{open:p,onClose:s,PaperProps:{style:{overflowY:"visible",width:"800px"}},children:[e.jsx(me,{children:"Add Music"}),e.jsxs(ue,{style:{zIndex:1},children:[e.jsx(Z,{rowGap:"1rem",display:"flex",flexDirection:"column",mt:"1rem",children:e.jsxs(se,{fullWidth:!0,variant:"outlined",sx:{mb:3},children:[e.jsx(ze,{id:"music-type-label",children:"Select Type"}),e.jsx(Ee,{labelId:"music-type-label",value:l.type,defaultValue:D,onChange:m=>{const o=m.target.value;i(t=>({...t,type:o}))},label:"Music Type",children:b})]})}),C()]}),e.jsxs(pe,{children:[e.jsx(Y,{onClick:s,children:"Cancel"}),e.jsx(Y,{onClick:()=>y(),color:"primary",variant:"contained",children:"Save"})]})]})})},Ct=u=>{const{open:p,handleClose:s,handleSaveChoristerOrganist:y,choristerOrganistForm:i,setChoristerOrganistForm:l,members:j}=u;return e.jsxs(de,{open:p,onClose:s,PaperProps:{style:{overflowY:"visible",width:"800px"}},children:[e.jsx(me,{children:"Chorister and Organist"}),e.jsx(ue,{style:{zIndex:1},children:e.jsxs(Z,{rowGap:"1rem",display:"flex",flexDirection:"column",mt:"1rem",children:[e.jsx(L,{formValues:{chorister:i.chorister},setFormValues:l,options:j.filter(g=>g.calling==="Chorister"),fieldName:"chorister",fieldLabel:"Chorister",optionText:"first_name last_name",autoFocus:!0},"chorister"),e.jsx(L,{formValues:{organist:i.organist},setFormValues:l,options:j.filter(g=>g.calling==="Organist"),fieldName:"organist",fieldLabel:"Organist",optionText:"first_name last_name",autoFocus:!1},"organist")]})}),e.jsxs(pe,{children:[e.jsx(Y,{onClick:s,children:"Cancel"}),e.jsx(Y,{onClick:()=>y(),color:"primary",variant:"contained",children:"Save"})]})]})},le={name:"",performer:"Ward Choir",type:"opening",date:void 0},Ot=u=>{const{date:p}=u;Be.chorister;const s=Ue(a=>a.members),y=Ye(a=>a.specialSundays),{musicHistory2:i,getMusicHistory2:l,musicAdmin:j}=oe(),{hymns:g}=Je(),[d,S]=h.useState({sundays:[]}),[A,_]=h.useState([]),[C,M]=h.useState(null),[b,D]=h.useState(!1),[m,o]=h.useState(!0),[t,r]=h.useState(le),[x,v]=h.useState(!1),[O,R]=h.useState(),[G,J]=h.useState(),[W,k]=h.useState({chorister:{first_name:"",last_name:""},organist:{first_name:"",last_name:""},date:p||""}),[$,ee]=h.useState({number:"",name:""}),[he,ge]=h.useState(),te=st(),Q=h.useRef(null),ye=["Primary Program","Christmas Program","Ward Conference"],xe=y&&y.filter(a=>!ye.includes(a.type));h.useEffect(()=>{if(i&&Array.isArray(i)&&i.length>0){const a=new Date().getFullYear(),c=Array.from({length:a-2023+2},(I,f)=>2024+f).flatMap(I=>nt(i,j,I));if(!c.filter(I=>p===I.date))return;S({sundays:c});const F=c.flatMap(I=>["opening","sacrament","intermediate","closing"].map(f=>I[f]).filter(f=>f&&f.id).map(f=>({id:f.id,hymn_number:f.hymn_number,name:f.name,performer:f.performer,type:f.type,date:f.date,chorister:f.chorister,organist:f.organist})));_(F),o(!1)}},[i]),h.useEffect(()=>{!m&&Q.current&&Q.current.scrollIntoView({block:"start"})},[te,m]);const T=void 0,w=C?A.find(a=>a.id===C):null,ve=a=>{const{active:n}=a;M(n.id)},Ce=async a=>{const{active:n,over:c}=a;M(null),c&&n.id!==c.id&&_(N=>{const F=N.findIndex(V=>V.id===n.id),I=N[F],f={...I,date:c.id},re=[...N.slice(0,F),...N.slice(F+1),f],Oe=re.filter(V=>V.date===f.date),q=[];return Oe.forEach((V,Ne)=>{const K=Ne+1;(V.order!==K||I.date!==c.id)&&(V.order=K,q.push({...V,order:K,date:c.id}))}),q.length>0&&be(q),re})},be=async a=>{try{const n=a.map(c=>E.patch(`${T}/api/music/${c.id}`,{date:c.date,order:c.order}));await Promise.all(n)}catch(n){console.error("Failed to update speaker date/order",n)}},je=async a=>{try{const n=await E.delete(`${T}/api/music`,{params:{musicId:a.id}})}catch(n){console.error("Error deleting music date",n)}l()},Se=(a,n)=>{ge(n),D(!0),r(c=>({...c,date:a}))},_e=async()=>{var c,N;let a,n;a={date:t.date,hymn_number:void 0,song_title:t.name,name:t.name,performer:t.performer,type:t.type},n={[`${t.type}_hymn`]:{id:99999,key:((c=t.performer)==null?void 0:c.first_name)!=null?`${t.performer.first_name} ${t.performer.last_name}`:t.performer,number:void 0,name:t.name,performer:t.performer}},t.hymn_number&&(console.log("we have a hymn number!"),a.hymn_number=t.hymn_number.number,a.song_title=t.hymn_number.name,a.name=t.hymn_number.name,n[`${t.type}_hymn`].number=t.hymn_number.number,n[`${t.type}_hymn`].name=t.hymn_number.name),((N=t.performer)==null?void 0:N.first_name)!=null&&(a.performer=t.performer.first_name+" "+t.performer.last_name,n[`${t.type}_hymn`].performer=t.performer.first_name+" "+t.performer.last_name);try{const F=await E.post(`${T}/api/music`,a),I={...a,id:F.data.id};oe.setState(f=>({musicHistory2:[...f.musicHistory2||[],I]})),Qe.getState().updateFormValue(`${t.type}_hymn`,n[`${t.type}_hymn`]),ee({number:"",name:""}),r(le),D(!1)}catch(F){console.error("Failed to save speaker",F)}},Me=()=>{ee({member:""}),D(!1)},De=async a=>{const n=W.chorister.id,c=W.organist.id,F={date:W.date,chorister_id:n,organist_id:c};console.log(F);try{const I=await E.post(`${T}/api/music-admin`,F);l(),v(!1)}catch(I){console.error("Failed to save music admin data",I)}},Ie=()=>{v(!1),setTimeout(()=>{k({chorister:{first_name:"",last_name:""},organist:{first_name:"",last_name:""},date:""})},300)},Ae=a=>{v(!0),k(n=>({...n,date:a}))},Fe=ot(d.sundays);return e.jsxs("div",{className:"container",style:{overflowY:"auto",height:"92vh"},children:[e.jsxs(Ze,{onDragStart:ve,onDragEnd:Ce,children:[e.jsx("div",{className:"scheduling-container",children:Fe.map(([a,n])=>e.jsxs("div",{ref:a===te?Q:null,children:[e.jsx("h3",{children:a}),e.jsx("div",{className:"month-row",children:n.map(c=>e.jsx(xt,{id:c.date,items:A,sunday:c,musicAdmin:j,setOpen:D,handleAddMusic:Se,specialSundays:xe,handleDeleteMusic:je,handleAddChoristerOrganist:Ae,members:s,setChoristerOrganistForm:k},c.date))})]},a))}),e.jsx(et,{children:w&&e.jsx(fe,{id:w.id,name:w.name,type:w.type,performer:w.performer,date:w.date},w.id)})]}),e.jsx(vt,{open:b,handleClose:Me,handleSaveSong:_e,selectedHymn:$,members:s,hymns:g,scheduledMusic:t,setScheduledMusic:r,disabledTypes:he}),e.jsx(Ct,{open:x,handleClose:Ie,handleSaveChoristerOrganist:De,members:s,selectedChorister:O,setSelectedChorister:R,selectedOrganist:G,setSelectedOrganist:J,choristerOrganistForm:W,setChoristerOrganistForm:k})]})};export{Ot as default};
