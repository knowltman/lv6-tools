import{c as q,j as e,k as R,a2 as K,p as C,a as Q,I as X,t as Z,u as ee,e as te,r as m,x as ae}from"./index-BywWJzti.js";import{u as se,D as ne,a as re,P as oe,b as ie,c as ce}from"./ProgramFieldLocal-uY5QBFw8.js";import{A as de,D as le,a as pe,b as me,c as ye}from"./Add-iX1LdWfD.js";import{g as V,C as ue}from"./getDate-CiplD_YF.js";import{g as fe,m as he,a as xe}from"./SchedulePage.logic-CGh8byPc.js";import{B as _}from"./Button-B-EFBJZ7.js";import"./Typography-DO_idQ2S.js";const ge=q(e.jsx("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVert"),Se={marginTop:".2rem",display:"flex",flexDirection:"column"},ve={fontWeight:600},be={textTransform:"capitalize"},E=({id:f,name:l,type:c,date:o,handleAddPrayer:h,dragComplete:x,fetchPrayers:g})=>{const{attributes:y,listeners:S,setNodeRef:D,transform:p}=se({id:f}),{deletePrayer:u}=R(),i=p?{opacity:.5}:void 0,P=c==="invocation"?"#d8e9fb":"#CCF1D7",v=c==="invocation"?"#99cbf9":"#84d3af",M=c==="invocation"?"#376ea4":"#376A5C",b={display:"flex",alignItems:"center",borderRadius:"4px",fontSize:".9rem",cursor:"move",padding:".2rem",border:`1px solid ${v}`};return!f&&!l?e.jsxs("div",{className:"add-item-button",onClick:()=>h(c,o),children:[e.jsx(de,{fontSize:"small"}),"add ",c]}):e.jsxs("div",{ref:D,className:"prayer-container",style:{backgroundColor:P,...b,...i},children:[e.jsx("div",{...y,...S,children:e.jsx(ne,{fontSize:"small",style:{color:v}})}),e.jsxs("div",{style:Se,children:[e.jsx("span",{style:ve,children:l}),e.jsx("i",{style:{color:M,...be},children:c})]}),e.jsx(K,{fontSize:"small",style:{color:v,cursor:"pointer"},className:"edit-button",onClick:()=>u(f,o)})]})},je=({id:f,items:l,onSwap:c,sunday:o,setOpen:h,handleAddPrayer:x,dragComplete:g,fetchPrayers:y,specialSundays:S})=>{const{setNodeRef:D}=re({id:f}),p=S.find(i=>i.date===o.date);V(C(o.date))<=7&&C(o.date).getDay();const u=V(C(o.date))<=7&&C(o.date).getDay()===0&&(C(o.date).getMonth()===3||C(o.date).getMonth()===9);return e.jsxs(ue,{ref:D,className:"sunday-card",variant:"outlined",children:[e.jsxs("div",{className:"card--header",children:[e.jsx("div",{className:"card--title",children:Q(C(o.date),"MMMM d")}),e.jsx(X,{size:"small",onClick:c,"aria-label":"Swap invocation and benediction",children:e.jsx(ge,{fontSize:"small"})})]}),e.jsx("div",{className:`card--content ${u||p&&!["Other","Fast Sunday"].includes(p.type)?"special-sunday":""}`,children:p&&p.type&&!["Other","Fast Sunday"].includes(p.type)?e.jsx("div",{className:"special-sunday-type",children:p.description||p.type}):u?e.jsx("div",{className:"special-sunday-type",children:"General Conference"}):l.filter(i=>i.date===o.date).sort((i,P)=>i.type==="invocation"?-1:1).map((i,P)=>e.jsx(E,{id:i.id,name:i.name,type:i.type,setOpen:h,handleAddPrayer:x,date:i.date,dragComplete:g,fetchPrayers:y,specialSundays:S},P))})]})},Ce=f=>{const{open:l,handleClose:c,handleSavePrayer:o,selectedMember:h,setSelectedMember:x,members:g}=f;return e.jsxs(le,{open:l,onClose:c,maxWidth:"lg",PaperProps:{style:{overflowY:"visible",width:"600px"}},children:[e.jsx(pe,{children:"Add Prayer"}),e.jsx(me,{style:{zIndex:1},children:e.jsx(Z,{rowGap:"1rem",display:"flex",flexDirection:"column",mt:"1rem",children:e.jsx(oe,{formValues:h,setFormValues:x,options:g,fieldName:"member",fieldLabel:"Member",optionText:"first_name last_name",autoFocus:!0},"member")})}),e.jsxs(ye,{children:[e.jsx(_,{onClick:c,children:"Cancel"}),e.jsx(_,{onClick:()=>o(),color:"primary",variant:"contained",children:"Save"})]})]})},De=["Primary Program","Christmas Program","Ward Conference"],Pe=void 0,Ve=f=>{const{prayerHistory2:l,getPrayerHistory2:c,addPrayer:o}=R(),h=ee(t=>t.members),x=te(t=>t.specialSundays),[g,y]=m.useState([]),[S,D]=m.useState(null),[p,u]=m.useState(!1),[i,P]=m.useState(!0),[v,M]=m.useState({speaker_id:void 0,date:void 0,type:void 0}),[b,N]=m.useState({member:""}),[T,F]=m.useState({sundays:[]}),[$,A]=m.useState(!1),B=x&&x.filter(t=>!De.includes(t.type)),I=fe(),z=m.useRef(null);m.useEffect(()=>{if(l&&Array.isArray(l)&&l.length>0){const t=new Date().getFullYear(),a=Array.from({length:t-2023+2},(s,j)=>2024+j).flatMap(s=>he(l,s));F({sundays:a});const d=a.flatMap(s=>[{id:s.invocation.id,name:s.invocation.name,date:s.date,type:"invocation"},{id:s.benediction.id,name:s.benediction.name,date:s.date,type:"benediction"}]);y(d),P(!1)}},[l]),m.useEffect(()=>{!i&&z.current&&z.current.scrollIntoView({block:"start"})},[I,i]);const w=S?g.find(t=>t.id===S):null,L=t=>{const{active:r}=t;D(r.id),A(!1)},O=async t=>{const{active:r,over:a}=t;D(null),a&&r.id!==a.id&&y(d=>{const s=d.findIndex(k=>k.id===r.id),j={...d[s],date:a.id},n=[...d.slice(0,s),...d.slice(s+1),j].sort((k,Me)=>k.type==="invocation"?-1:1);return Y(j,s,d),A(!0),n})},Y=async(t,r,a)=>{try{(await ae.put(`${Pe}/api/prayer/${t.id}`,{date:t.date})).status===200?F(s=>{const j=s.sundays.map(n=>{if(n.date===a[r].date){if(a[r].type==="invocation")return{...n,invocation:{}};if(a[r].type==="benediction")return{...n,benediction:{}}}if(n.date===t.date){if(t.type==="invocation")return{...n,invocation:{id:t.id,name:t.name}};if(t.type==="benediction")return{...n,benediction:{id:t.id,name:t.name}}}return n});return{...s,sundays:j}}):y(a)}catch(d){console.error("Failed to update prayer date",d),y(a)}},W=t=>{y(r=>{const a=r.filter(n=>n.date===t);if(a.length!==2)return r;const[d,s]=a;return r.map(n=>{if(n.date===t){if(n.id===d.id)return{...n,type:s.type};if(n.id===s.id)return{...n,type:d.type}}return n}).sort((n,k)=>n.type==="invocation"?-1:1)})},G=(t,r)=>{u(!0),M(a=>({...a,date:r,type:t}))},H=async()=>{if(b.member){const t={...v,speaker_id:b.member.id,speaker_name:`${b.member.first_name} ${b.member.last_name}`};M(t);try{o(t,v.type),N({member:""}),u(!1)}catch(r){console.error("Failed to save prayer",r)}}},J=()=>{N({member:""}),u(!1)},U=xe(T.sundays);return e.jsxs("div",{className:"container",style:{overflowY:"auto",height:"92vh"},children:[e.jsxs(ie,{onDragStart:L,onDragEnd:O,children:[e.jsx("div",{className:"scheduling-container",children:U.map(([t,r])=>e.jsxs("div",{ref:t===I?z:null,children:[e.jsx("h3",{children:t}),e.jsx("div",{className:"month-row",children:r.map(a=>e.jsx(je,{id:a.date,onSwap:()=>W(a.date),items:g,sunday:a,setOpen:u,handleAddPrayer:G,dragComplete:$,setDragComplete:A,fetchPrayers:c,specialSundays:B},a.date))})]},t))}),e.jsx(ce,{children:w&&e.jsx(E,{id:w.id,name:w.name,type:w.type})})]}),e.jsx(Ce,{open:p,handleClose:J,handleSavePrayer:H,scheduledPrayer:v,selectedMember:b,setSelectedMember:N,members:h})]})};export{Ve as default};
